<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerar Senhas de Atendimento</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 30px;
      background-color: #f8f8f8;
    }

    h1 {
      color: #333;
    }

    input, button {
      margin: 10px;
      padding: 8px;
      font-size: 16px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    .footer {
      margin-top: 20px;
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>Gerador de Senhas de Atendimento</h1>
  <p>Selecione a data para gerar as senhas:</p>
  <input type="date" id="data" />
  <button onclick="gerarPDF()">Gerar PDF</button>

  <div class="footer">Cada turno gera 10 senhas, manh√£ e tarde em p√°ginas separadas.</div>

  <script>
        // üîπ Ao pressionar Enter no campo de data, gera automaticamente o PDF
    document.getElementById("data").addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        gerarPDF();
      }
    });

    async function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const dataSelecionada = document.getElementById("data").value;
      if (!dataSelecionada) {
        alert("Por favor, selecione uma data.");
        return;
      }

      // Corrige o fuso (evita o bug de um dia antes)
      const data = new Date(`${dataSelecionada}T00:00:00`);
      const opcoes = { year: 'numeric', month: '2-digit', day: '2-digit' };
      const dataFormatada = data.toLocaleDateString('pt-BR', opcoes);

      function gerarSenhas(turno, horarios) {
        // üîß Margens seguras ajustadas
        const startX = 20;   // antes 15 ‚Äî aumentada margem esquerda
        const startY = 20;
        const largura = 85;  // reduzida para equilibrar visual
        const altura = 38;
        const margem = 12;   // espa√ßamento entre colunas
        const colunas = 2;
        const linhas = 5;

        let senha = 1;
        for (let linha = 0; linha < linhas; linha++) {
          for (let coluna = 0; coluna < colunas; coluna++) {
            const x = startX + coluna * (largura + margem);
            const y = startY + linha * (altura + margem);

            doc.rect(x, y, largura, altura);

            // N√∫mero da senha
            doc.setFontSize(22);
            doc.setFont("helvetica", "bold");
            doc.text(`Senha ${senha}`, x + largura / 2, y + 16, { align: "center" });

            // Dia da semana e data
            const diasSemana = [
              "Domingo", "Segunda-feira", "Ter√ßa-feira",
              "Quarta-feira", "Quinta-feira", "Sexta-feira", "S√°bado"
            ];
            const diaSemana = diasSemana[data.getDay()];
            const linhaData = `${diaSemana} ‚Äî ${dataFormatada}`;

            doc.setFontSize(13);
            doc.setFont("helvetica", "normal");
            doc.text(linhaData, x + largura / 2, y + 27, { align: "center" });

            // Hor√°rio
            doc.setFontSize(13);
            doc.text(`Hor√°rio: ${horarios[senha - 1]}`, x + largura / 2, y + 35, { align: "center" });

            senha++;
            if (senha > horarios.length) return;
          }
        }
      }

      const horariosManha = [
        "07:30", "07:50", "08:10", "08:30", "08:50",
        "09:10", "09:30", "09:50", "10:10", "10:30"
      ];

      const horariosTarde = [
        "12:30", "12:50", "13:10", "13:30", "13:50",
        "14:10", "14:30", "14:50", "15:10", "15:30"
      ];

      // P√°gina 1 - Manh√£
      doc.setFontSize(16);
      doc.text("Turno da Manh√£", 105, 10, { align: "center" });
      gerarSenhas("Manh√£", horariosManha);

      // P√°gina 2 - Tarde
      doc.addPage();
      doc.text("Turno da Tarde", 105, 10, { align: "center" });
      gerarSenhas("Tarde", horariosTarde);

      // Salvar o PDF
      doc.save(`senhas_${dataSelecionada}.pdf`);
    }
  </script>
</body>
</html>